package com.hospital.uciRegistration.infraestructure.mappers;

import com.hospital.uciRegistration.domain.model.patient.Patient;
import com.hospital.uciRegistration.domain.model.ticket.*;
import com.hospital.uciRegistration.infraestructure.entity.TicketEntity;
import org.springframework.stereotype.Component;

@Component
public class TicketMapper {

    private final PatientMapper patientMapper;
    private final TriageInfoMapper triageInfoMapper;

    public TicketMapper(PatientMapper patientMapper, TriageInfoMapper triageInfoMapper) {
        this.patientMapper = patientMapper;
        this.triageInfoMapper = triageInfoMapper;
    }

    public TicketEntity toEntity(Ticket ticket) {
        if (ticket == null) {
            return null;
        }

        TicketEntity entity = new TicketEntity();
        entity.setId(ticket.getId());
        entity.setPatient(patientMapper.toPatientEntity(ticket.getPatient()));
        entity.setPriority(ticket.getPriority());
        entity.setColor(ticket.getColorCode().getColor());
        entity.setNoun(ticket.getColorCode().getNoun());
        entity.setColorCode(ticket.getColorCode().getColor_code());

        if (ticket.getTriageInfo() != null) {
            entity.setRiskOfFall(ticket.getTriageInfo().isRiskOfFall());
            entity.setBreathingDifficulty(ticket.getTriageInfo().isBreathingDifficulty());
            entity.setSeverePain(ticket.getTriageInfo().isSeverePain());
            entity.setBleeding(ticket.getTriageInfo().isBleeding());
            entity.setUnconscious(ticket.getTriageInfo().isUnconscious());
        }

        entity.setCreatedAt(ticket.getCreatedAt());
        entity.setStatus(ticket.getStatus());

        return entity;
    }

    public Ticket fromEntity(TicketEntity entity) {
        if (entity == null) {
            return null;
        }

        Patient patient = patientMapper.fromPatientEntity(entity.getPatient());
        TriageInfo triageInfo = triageInfoMapper.fromEntityFields(
                entity.isRiskOfFall(),
                entity.isBreathingDifficulty(),
                entity.isSeverePain(),
                entity.isBleeding(),
                entity.isUnconscious()
        );

        ColorCode colorCode = new ColorCode(entity.getColor(), entity.getNoun());

        return new Ticket(
                entity.getId(),
                patient,
                entity.getPriority(),
                colorCode,
                triageInfo,
                entity.getCreatedAt(),
                entity.getStatus()
        );
    }
}
